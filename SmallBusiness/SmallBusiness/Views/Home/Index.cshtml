@using System.Security.Claims;
@model SmallBusiness.Models.Testimonial
@{
    ViewData["Title"] = "Home Page";
}
<style>
    .circle{
        width: 48px;
        height: 48px;
        margin: 0 5px;
        text-align: center;
        color: #fff;
        border-radius: 50%;
        background-color: #333;
    }
    
    .icon{
        font-size: 16px;
        line-height: 48px;
    }
    
</style>
<!-- Slider main container Start -->
<div class="home1-slider swiper-container">
    <div class="swiper-wrapper">
        <div class="home1-slide-item swiper-slide" data-swiper-autoplay="5000" data-bg-image="https://htmldemo.net/learts/learts/assets/images/slider/home1/slide-2.webp">
            <div class="home1-slide1-content">
                <span class="bg"></span>
                <span class="slide-border"></span>
                <span class="icon"><img src="~/assets/images/slider/home1/slide-1-1.webp" alt="Slide Icon"></span>
                <h2 class="title">Handicraft Shop</h2>
                <h3 class="sub-title">Just for you</h3>
                <div class="link"><a asp-action="products" asp-controller="Product">shop now</a></div>
            </div>
        </div>
        <div class="home1-slide-item swiper-slide" data-swiper-autoplay="5000" data-bg-image="https://htmldemo.net/learts/learts/assets/images/slider/home1/slide-1.webp">
            <div class="home1-slide2-content">
                <span class="bg" data-bg-image="~/assets/images/slider/home1/slide-2-1.webp"></span>
                <span class="slide-border"></span>
                <span class="icon">
                    <img src="~/assets/images/slider/home1/slide-2-2.webp" alt="Slide Icon">
                    <img src="~/assets/images/slider/home1/slide-2-3.webp" alt="Slide Icon">
                </span>
                <h2 class="title">Newly arrived</h2>
                <h3 class="sub-title">Sale up to <br>10%</h3>
                <div class="link"><a asp-action="ProductSale" asp-controller="Product">shop now</a></div>
            </div>
        </div>
      
    </div>
    <div class="home1-slider-prev swiper-button-prev"><i class="ti-angle-left"></i></div>
    <div class="home1-slider-next swiper-button-next"><i class="ti-angle-right"></i></div>
</div>
<!-- Slider main container End -->


<!-- Category Banner Style Four Section Start -->
<div class="section section-padding pt-0 mt-5">
    <div class="container">

        <!-- Section Title Start -->
        <div class="section-title2 text-center">
            <h3 class="sub-title">Shop by categories</h3>
            <p>Browse a wide range of distinctive pieces of arts you could never find elsewhere.</p>
        </div>
        <!-- Section Title End -->

        <div class="row row-cols-lg-4 row-cols-sm-2 row-cols-1 learts-mb-n40">
               @foreach (var category in ViewBag.categoryList)
            {
              
            <div class="col learts-mb-40">
                <div class="category-banner4">
                        <a asp-action="products" asp-controller="Product" asp-route-CategoryName="@category.CategoryName" class="inner">
                            <div class="image"><img src="~/CategoryImg/@category.Image" alt=""></div>
                        <div class="content" data-bg-color="#f4ede7">
                                <h3 class="title">@category.CategoryName</h3>
                        </div>
                    </a>
                </div>
            </div>

         }

        </div>

    </div>
</div>
<!-- Category Banner Style Four Section End -->






<!-- Product Section Start -->
<div class="section section-padding border-bottom">
    <div class="container">
        <!-- Section Title Start -->
        <div class="section-title2 text-center">
            <h2 class="title">Product Tab Style 01</h2>
        </div>
        <!-- Section Title End -->
        <!-- Product Tab Start -->
        <div class="row">
            <div class="col-12">
                <ul class="product-tab-list nav">
                    <li><a class="active" data-bs-toggle="tab" href="#tab-new-sale">New arrivals</a></li>
                    <li><a data-bs-toggle="tab" href="#tab-sale-items">Sale items</a></li>
                    <li><a data-bs-toggle="tab" href="#tab-best-sellers">Best sellers</a></li>
                </ul>
                <div class="prodyct-tab-content1 tab-content">
                    <div class="tab-pane fade show active" id="tab-new-sale">
                        <!-- Products Start -->
                        <div class="products row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-1">
                            @functions {
                                bool IsProductInUserFavorites(List<Favorite> favorites, int productId, string userId)
                                {
                                    return favorites != null && favorites.Any(f => f.ProductId == productId && f.UserId == userId);
                                }
                            }

                            @{
                                // Get the current user ID
                                var currentUserId = User.FindFirstValue(ClaimTypes.NameIdentifier);
                            }

                            @foreach (var newProduct in ViewBag.NewProducts)
                            {
                                <div class="col">
                                    <div class="product">
                                        <div class="product-thumb">
                                            <a href="product-details.html" class="image">
                                                <img src="~/CategoryImg/@newProduct.ImageUrl" alt="Product Image">
                                                <img class="image-hover " src="~/CategoryImg/@newProduct.ImageUrl" alt="Product Image">
                                            </a>
                                            <button type="button" class="add-to-wishlist " data-product-id="@newProduct.ProductId" onclick="toggleFavorite(this)" style="background:none;border:none">
                                                <i class="@(IsProductInUserFavorites(ViewBag.Fav, newProduct.ProductId, currentUserId) ? "fas" : "far") fa-heart" data-fav="@IsProductInUserFavorites(ViewBag.Fav, newProduct.ProductId, currentUserId)"></i>
                                            </button>
                                        </div>
                                        <div class="product-info">
                                            <h6 class="title"><a href="product-details.html">@newProduct.ProductName</a></h6>
                                            <span class="price">$@newProduct.ProductPrice</span>
                                            <div class="product-buttons">
                                                <a href="#" class="product-button hintT-top" data-hint="Quick View" onclick="showProductDetails(@newProduct.ProductId)">
                                                    <i class="fas fa-search"></i>
                                                </a>
                                                <a class="addToCartButton circle" data-product-id="@newProduct.ProductId" data-change="add" class="product-button hintT-top" data-hint="Add to Cart"><i class="fas fa-shopping-cart icon"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                        </div>
                        <!-- Products End -->
                    </div>
                    <div class="tab-pane fade" id="tab-sale-items">
                        <!-- Products Start -->
                        <div class="products row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-1">
                            @foreach (var discountedProduct in ViewBag.DiscountedProducts)
                            {
                                <div class="col">
                                    <div class="product">
                                        <div class="product-thumb">
                                            <a href="product-details.html" class="image">
                                                <span class="product-badges">
                                                    <span class="onsale">-@discountedProduct.DiscountPercent.ToString("0.")%</span>
                                                </span>
                                                <img src="~/CategoryImg/@discountedProduct.ImageUrl" alt="Product Image">
                                                <img class="image-hover " src="~/CategoryImg/@discountedProduct.ImageUrl" alt="Product Image">
                                            </a>
                                            <button type="button" class="add-to-wishlist " data-product-id="@discountedProduct.ProductId" onclick="toggleFavorite(this)" style="background:none;border:none">
                                                <i class="@(IsProductInUserFavorites(ViewBag.Fav, discountedProduct.ProductId, currentUserId) ? "fas" : "far") fa-heart" data-fav="@IsProductInUserFavorites(ViewBag.Fav, discountedProduct.ProductId, currentUserId)"></i>
                                            </button>
                                        </div>
                                        <div class="product-info">
                                            <h6 class="title"><a href="product-details.html">@discountedProduct.ProductName</a></h6>
                                            <span class="price">
                                                <span class="old">$@discountedProduct.OldPrice</span>
                                                <span class="new">$@discountedProduct.NewPrice.ToString("0.00")</span>
                                            </span>
                                            <div class="product-buttons">
                                                <a href="#quickViewModal" data-bs-toggle="modal" class="product-button hintT-top" data-hint="Quick View"><i class="fas fa-search"></i></a>
                                                <a class="addToCartButton" data-product-id="@discountedProduct.ProductId" data-change="add" class="product-button hintT-top" data-hint="Add to Cart"><i class="fas fa-shopping-cart"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            }

                        </div>
                        <!-- Products End -->
                    </div>
                    <div class="tab-pane fade" id="tab-best-sellers">
                        <!-- Products Start -->
                        <div class="products row row-cols-lg-4 row-cols-md-3 row-cols-sm-2 row-cols-1">
                            @foreach (var rateProduct in ViewBag.MostRatedProducts)
                            {
                                <div class="col">
                                    <div class="product">
                                        <div class="product-thumb">
                                            <span class="product-badges">
                                                <span class="hot">hot</span>
                                            </span>
                                            <a href="product-details.html" class="image">
                                                <img src="~/CategoryImg/@rateProduct.ImageUrl" alt="Product Image">
                                                <img class="image-hover " src="~/CategoryImg/@rateProduct.ImageUrl" alt="Product Image">
                                            </a>
                                            <button type="button" class="add-to-wishlist " data-product-id="@rateProduct.ProductId" onclick="toggleFavorite(this)" style="background:none;border:none">
                                                <i class="@(IsProductInUserFavorites(ViewBag.Fav, rateProduct.ProductId, currentUserId) ? "fas" : "far") fa-heart" data-fav="@IsProductInUserFavorites(ViewBag.Fav, rateProduct.ProductId, currentUserId)"></i>
                                            </button>
                                        </div>
                                        <div class="product-info">
                                            <h6 class="title"><a href="product-details.html">@rateProduct.ProductName</a></h6>
                                            <span class="price">
                                                $@rateProduct.ProductPrice
                                            </span>
                                            <div class="product-buttons">
                                                <a href="#quickViewModal" data-bs-toggle="modal" class="product-button hintT-top" data-hint="Quick View"><i class="fas fa-search"></i></a>
                                                <a class="addToCartButton" data-product-id="@rateProduct.ProductId" data-change="add" class="product-button hintT-top" data-hint="Add to Cart"><i class="fas fa-shopping-cart" style="font-size: 16px;line-height: 48px;"></i></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            }

                        </div>
                        <!-- Products End -->
                    </div>
                </div>
            </div>
        </div>
        <!-- Product Tab End -->
       @* <div class="row g-0 justify-content-center learts-mt-50">
            <a href="#" class="btn p-0"><i class="ti-plus"></i> load more ...</a>
        </div>*@

    </div>
</div>
<!-- Product Section End -->



<!-- Testimonial Section Start -->
<div class="section section-padding">
    <div class="container">

        <div class="section-title2 row justify-content-between align-items-center">
            <div class="col-md-auto col-12">
                <!-- Section Title Start -->
                <h2 class="title title-icon-right">We love our clients</h2>
                <!-- Section Title End -->
            </div>
        </div>

        <div class="testimonial-carousel">
            @if (ViewBag.Reviews != null)
            {
                @foreach (var testimonial in ViewBag.Reviews)
                {
                    <div class="col">
                        <div class="testimonial">
                            <p>@testimonial.TestimonialMessage</p>
                            <div class="author">
                                @if (testimonial.User != null)
                                {
                                    <img src="~/@testimonial.User.Image" alt="">

                                }
                                else
                                {
                                    <text>Unknown Image</text>
                                }
                                <div class="content">
                                    <h6 class="name">@testimonial.Name</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            }
            else
            {
                <p>No Reviews to show</p>
            }
        </div>

    </div>
</div>
<!-- Testimonial Section End -->





<div class="section section-padding border-bottom">
    <div class="container">
        <h2 class="title title-icon-right">Add a review</h2>
        <div class="review-form">
            <p class="note">Your email address will not be published. Required fields are marked *</p>
            <form method="post" asp-action="Testimonial" asp-controller="Home">
                <div class="row learts-mb-n30">
                    <div class="col-md-6 col-12 learts-mb-30">
                        <input type="text" asp-for="Name" name="Name" placeholder="Name *">
                    </div>
                    <div class="col-md-6 col-12 learts-mb-30">
                        <input type="email" name="Email" placeholder="Email *" asp-for="Email">
                    </div>
                    <div class="col-12 learts-mb-10"></div>
                    <div class="col-12 learts-mb-30">
                        <textarea name="TestimonialMessage" placeholder="Your Review *" asp-for="TestimonialMessage"></textarea>
                    </div>
                    <div class="col-12 text-center learts-mb-30">
                        <button type="submit" class="btn btn-dark btn-outline-hover-dark">Submit</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>




@section scripts {
    <script>
        function toggleFavorite(button) {
            var productId = $(button).data('product-id');
            var heartIcon = $(button).find('i');
            var initialFavState = $(heartIcon).data('fav');

            $.ajax({
                url: '@Url.Action("ToggleFavorite", "Favorite")',
                type: 'POST',
                data: { productId: productId },
                success: function (data) {
                    if (data.isFav) {
                        heartIcon.removeClass('far').addClass('fas');
                    } else {
                        heartIcon.removeClass('fas').addClass('far');
                    }

                    $(heartIcon).data('fav', data.isFav);

                    // Reload the page
                    location.reload();
                },
                error: function (xhr, status, error) {
                    console.error('Error during AJAX request:', error);
                    // Handle error as needed
                }
            });
        }
    </script>
}


@*<script>
    $(document).ready(function () {
        // Attach click event to the "Add to Cart" button
        $("#addToCartButton").click(function () {
            var productId = $(this).data("product-id");
            var change = $(this).data("change");

            $.ajax({
                type: "POST",
                url: "/Shopping/Cart",
                data: { productId: productId, change: change },
                success: function (result) {
                    // Update the offcanvas cart with the returned HTML
                    $("#offcanvas-cart .body").html($(result).find(".body").html());

                    // Display the offcanvas cart if it was hidden
                    $("#offcanvas-cart").addClass("show");
                },
                error: function (error) {
                    console.log("Error fetching partial view:", error);
                    // Handle the error, show an alert, or log the error as needed
                }
            });
        });

        // Attach click event to the offcanvas close button
        $(".offcanvas-close").click(function () {
            $("#offcanvas-cart").removeClass("show");
            // Reload the page after closing the offcanvas
            location.reload(true); // Force a reload from the server
        });
    });


</script>*@





<script>
    $(document).ready(function () {
        // Attach click event to the "Add to Cart" button with class addToCartButton
        $(".addToCartButton").click(function () {
            var productId = $(this).data("product-id");
            var change = $(this).data("change");

            $.ajax({
                type: "POST",
                url: "/Shopping/Cart",
                data: { productId: productId, change: change },
                success: function (result) {
                    // Update the offcanvas cart with the returned HTML
                    $("#offcanvas-cart .body").html($(result).find(".body").html());

                    // Display the offcanvas cart if it was hidden
                    $("#offcanvas-cart").addClass("show");
                },
                error: function (error) {
                    console.log("Error fetching partial view:", error);
                    // Handle the error, show an alert, or log the error as needed
                }
            });
        });

        // Attach click event to the offcanvas close button
        $(".offcanvas-close").click(function () {
            $("#offcanvas-cart").removeClass("show");
            // Reload the page after closing the offcanvas
            location.reload(true); // Force a reload from the server
        });
    });
</script>
